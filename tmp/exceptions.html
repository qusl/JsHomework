<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Double click to show the detail information</title>
    <link rel="stylesheet" href="/css/dx.common.css" />
    <link rel="stylesheet" href="/css/tb.light.darkred.css" />
    <script src="/lib/jquery/jquery-2.1.4.min.js"></script>
    <script src="/lib/angular/angular.min.js"></script>
    <script src="/scripts/app.initial.js?161101"></script>
    <script src="/scripts/app.util.js?161101"></script>
    <script src="/scripts/app.service.helper.js?161101"></script>
    <script src="/lib/devextreme/dx.web.js"></script>
    <link href="lib/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <script src="lib/sweetalert2/sweetalert2.min.js"></script>
    <script src="/scripts/devextreme/mygridconfigForReport.js?161101"></script>
    <script src="scripts/dataconfig/_exceptions.js?161101"></script>
    <link href="css/reportStyles.css" rel="stylesheet" />
</head>
    <body ng-app="appExceptions" ng-controller="exceptionLogController">
        <div id="loading" class="hide">
            <div id="loading-content">
                <img src="images/loading.gif" />
            </div>
        </div>
        <div style="text-align: center"><h3>Latest 100 Exceptions - Double Click to show detail</h3></div>
        <div class="main-content">
            <div id="myGridViewForReport"></div>
        </div>
        <script>
            CmpToolUtility.showLoadingPage();
            var app = angular.module("appExceptions", []);
            app.controller("exceptionLogController", function ($scope, $http) {
                refreshGrid($scope, $http);
            });

            var refreshGrid = function (scope, myhttp) {
                var tableName = "Log";
                var getMethod = "GetLatestErrorsForReport";
                var fullUrl = CmpToolStatic.apiUrl + "Api/" + tableName + "/" + getMethod + "/";

                var clickTimer, lastRowCLickedId;
                var myGrid = angular.copy(window.CmpTool.myGridConfigForReport);
                myGrid.columns = window.CmpTool.configExceptionColumns(scope);
                myGrid.onRowClick = function (e) {
                    if (clickTimer && lastRowCLickedId === e.rowIndex) {
                        clearTimeout(clickTimer);
                        clickTimer = null;
                        lastRowCLickedId = e.rowIndex;
                        var handlingInstanceId = e.data.HandlingInstanceId;
                        if (handlingInstanceId) {
                            var url = '/exceptionDetail.html?HandlingInstanceId=' + handlingInstanceId;
                            window.open(url);
                        } else {
                            Alert('HandlingInstanceId is empty!');
                        }
                        //console.log('double');
                    } else {
                        clickTimer = setTimeout(function () {
                            //console.log('single');
                        }, 250);
                    }

                    lastRowCLickedId = e.rowIndex;
                }
                window.CmpTool.ServiceHelper.getItem(myhttp, fullUrl).then(function (respRefresh) {
                    myGrid.dataSource = respRefresh.data;
                    CmpToolUtility.refreshDataGrid($("#myGridViewForReport"), myGrid);
                    CmpToolUtility.hideLoadingPage();
                });
            };
        </script>
    </body>

    </html>
